# Integration Spec: bids-hub → neuroimaging-go-brrrr

**Status**: Ready for Implementation
**Source**: `_reference_repos/bids-hub/` (git-delinked copy)

---

## Executive Summary

We're integrating a complete, battle-tested production pipeline (1,976 lines) into an empty skeleton.

| What Exists | What We're Adding |
|-------------|-------------------|
| Empty `src/neuroimaging_go_brrrr/` | Full `src/bids_hub/` (13 Python files) |
| Broken toy script | Working CLI with 10+ commands |
| Missing deps | Complete dependency set + critical git pin |
| No tests | 9 test files with fixtures |
| Minimal .gitignore | Complete .gitignore with BIDS patterns |

---

## Phase Overview

| Phase | Spec | Description | Complexity |
|-------|------|-------------|------------|
| 1 | [01-copy-source.md](./01-copy-source.md) | Copy `src/bids_hub/` + docs | Trivial |
| 2 | [02-update-pyproject.md](./02-update-pyproject.md) | Replace `pyproject.toml` | Medium |
| 3 | [02b-merge-configs.md](./02b-merge-configs.md) | Merge .gitignore, .pre-commit, Makefile | Medium |
| 4 | [03-copy-tests.md](./03-copy-tests.md) | Replace tests/ | Trivial |
| 5 | [04-cleanup.md](./04-cleanup.md) | Delete obsolete + copy scripts | Trivial |
| 6 | [05-verify.md](./05-verify.md) | Full verification | Verify |

---

## Decision: Keep `bids_hub` Package Name

**DO NOT rename to `neuroimaging_go_brrrr`**

Reasons:
1. `bids_hub` is accurate (BIDS → HuggingFace Hub)
2. CLI is `bids-hub` (clear, memorable)
3. Renaming breaks imports in all test files
4. The repo name (`neuroimaging-go-brrrr`) ≠ package name (that's normal)

The package inside is `bids_hub`. The repo that hosts it is `neuroimaging-go-brrrr`.

---

## Complete File Mapping

### Files to COPY

| Source | Destination | Notes |
|--------|-------------|-------|
| `src/bids_hub/` | `src/bids_hub/` | Complete package (1,976 lines) |
| `tests/` | `tests/` | Replace existing (9 test files) |
| `CLAUDE.md` | `CLAUDE.md` | Replace (reference has complete context) |
| `UPSTREAM_BUG.md` | `UPSTREAM_BUG.md` | New file (critical upstream bug docs) |
| `CITATION.cff` | `CITATION.cff` | New file (citation metadata) |
| `CHANGELOG.md` | `CHANGELOG.md` | New file (version history) |
| ~~`CONTRIBUTING.md`~~ | ~~`CONTRIBUTING.md`~~ | **SKIP** - Keep target's version |
| `scripts/download_arc.sh` | `scripts/download_arc.sh` | New file (robust download script) |
| `scripts/download_isles24.sh` | `scripts/download_isles24.sh` | New file (ISLES24 download) |

### Files to MERGE

| Source | Target | Notes |
|--------|--------|-------|
| `pyproject.toml` | `pyproject.toml` | Replace entirely (see Phase 2) |
| `.gitignore` | `.gitignore` | Append BIDS patterns (see Phase 3) |
| `.pre-commit-config.yaml` | `.pre-commit-config.yaml` | Merge mypy deps (see Phase 3) |
| `Makefile` | `Makefile` | Merge targets (see Phase 3) |

### Files to DELETE

| File | Reason |
|------|--------|
| `src/neuroimaging_go_brrrr/` | Empty skeleton, useless |
| `scripts/push_to_hub_ds004884_full.py` | Broken toy script (wrong API, no validation) |
| `scripts/download_ds004884.sh` | Replaced by `download_arc.sh` |

### Files to KEEP (no changes)

| File | Reason |
|------|--------|
| `scripts/visualization/` | Tobias's consumption pipeline demos |
| `docs/brainstorming/` | Context documentation |
| `docs/specs/` | These integration specs |
| `.gitmodules` | Tobias's HF space submodule link |
| `README.md` | Target repo has different context/branding |
| `CONTRIBUTING.md` | Target repo has existing contribution guidelines |

---

## Files NOT Copied (intentional)

| Source File | Reason NOT Copied |
|-------------|-------------------|
| `LICENSE` | Target repo already has license |
| `README.md` | Target repo has different context/branding |
| `CONTRIBUTING.md` | Target repo has existing contribution guidelines |
| `GEMINI.md` | Gemini-specific context (not needed) |
| `mypy.ini` | Merged into pyproject.toml [tool.mypy] |
| `docs/` | Reference docs specific to standalone bids-hub repo |
| `uv.lock` | Regenerated by `uv sync` |
| `.markdownlint.yaml` | Not using markdown linting locally |

**Note**: The reference `docs/` contains tutorials and API docs. These could be copied later if needed, but are not essential for the integration.

---

## Success Criteria

```bash
# 1. CLI works
uv run bids-hub --help
uv run bids-hub list
uv run bids-hub arc --help
uv run bids-hub isles24 --help

# 2. All tests pass
uv run pytest -v

# 3. Imports work
python -c "from bids_hub import build_and_push_arc, ValidationResult; print('OK')"

# 4. Linting passes
uv run ruff check src/ tests/
uv run mypy src/

# 5. Download scripts work
./scripts/download_arc.sh --help  # Should show usage
./scripts/download_isles24.sh --help  # Should show usage
```

---

## Quick Reference (All Commands)

```bash
# Phase 1: Copy source + docs (NOT CONTRIBUTING.md - keep target's)
cp -r _reference_repos/bids-hub/src/bids_hub src/
cp _reference_repos/bids-hub/CLAUDE.md .
cp _reference_repos/bids-hub/UPSTREAM_BUG.md .
cp _reference_repos/bids-hub/CITATION.cff .
cp _reference_repos/bids-hub/CHANGELOG.md .

# Phase 2: Replace pyproject.toml (see spec for full content)

# Phase 2b: Merge configs (see spec for details)

# Phase 3: Copy tests
rm -rf tests/ && cp -r _reference_repos/bids-hub/tests .

# Phase 4: Delete obsolete + copy scripts
rm -rf src/neuroimaging_go_brrrr/
rm scripts/push_to_hub_ds004884_full.py scripts/download_ds004884.sh
cp _reference_repos/bids-hub/scripts/download_arc.sh scripts/
cp _reference_repos/bids-hub/scripts/download_isles24.sh scripts/
chmod +x scripts/download_*.sh

# Phase 5: Verify
uv sync --all-extras && uv run pytest -v && uv run bids-hub --help
```
